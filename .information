node.jsã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§ç°¡æ˜“MCP ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ/ã‚µãƒ¼ãƒãƒ¼ã‚’ä½œæˆã™ã‚‹
ã¯ã˜ã‚ã«
å··ã§è©±é¡Œã®MCPã«ã¤ã„ã¦ã€Claude Desktopã‚„Cursor, Clineãªã©ã‚’MCPã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã¨ã—ã¦ç´¹ä»‹ã•ã‚Œã¦ã„ã‚‹è¨˜äº‹ã¯å¤šã„ã‚‚ã®ã®ã€node.jsã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«çµ„ã¿è¾¼ã‚€æ–¹æ³•ã¯ç´¹ä»‹ã•ã‚Œã¦ã„ãªã„ã‚ˆã†ã«æ„Ÿã˜ãŸã®ã§ã€è‡ªä½œã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«çµ„ã¿è¾¼ã‚€æ–¹æ³•ã‚’ç´¹ä»‹ã—ã¾ã™ã€‚

å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚„ãã®ä»–ãƒ–ãƒ­ã‚°ç­‰ã®æƒ…å ±ã§ã‚ã‚‹ç¨‹åº¦MCPã®æƒ…å ±ã‚’ã‚­ãƒ£ãƒƒãƒã‚¢ãƒƒãƒ—ã—çµ‚ã‚ã‚Šã€ãã‚ãã‚å®Ÿè£…ã—ã¦ã¿ã‚ˆã†ã‹ãªã¨ã„ã£ãŸäººã®å‚è€ƒã«ãªã‚Œã°å¬‰ã—ã„ãªãƒ¼ã¨æ€ã£ã¦ã„ã¾ã™ã€‚

è¨˜äº‹ã‚’èª­ã‚€ã®ãŒé¢å€’ãªæ–¹ã¯ä»¥ä¸‹ã§å®Ÿè£…ã‚’å…¬é–‹ã—ã¦ã„ã¾ã™ã€‚ https://github.com/nyankiti/genai-lab/blob/main/src/mcpApp.ts

ãã‚‚ãã‚‚MCPã¨ã¯
Introduction - Model Context Protocol
Get started with the Model Context Protocol (MCP)

modelcontextprotocol.io
LLMã«å¤–éƒ¨ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹ã‚’çµ„ã¿è¾¼ã‚€ãŸã‚ã®ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã§ã™ã€‚ å¤–éƒ¨ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹ã¨ã¯ã€æœ€æ–°ã®å¤©æ°—ã‚„ãƒ­ãƒ¼ã‚«ãƒ«ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ ã€è‡ªç¤¾ã®DBãªã©æ§˜ã€…ã§ã™ã€‚MCPã§çµ±ä¸€ã•ã‚Œã‚‹ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã«å¾“ã£ã¦ã€AI Agentçš„ã«å‹•ãLLMã«è¿½åŠ ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’æä¾›ã™ã‚‹ã‚‚ã®ã¨ãªã‚Šã¾ã™ã€‚ ã§ãã‚‹ã“ã¨ã¨ã—ã¦ã¯ã€openAIã®function-callingã¨ã»ã¨ã‚“ã©åŒã˜ã¨æ„Ÿã˜ã¦ã„ã¾ã™ã€‚function-callingã«æ¯”è¼ƒã—ã¦å®Ÿè£…ã®è‡ªç”±åº¦ãŒé«˜ããƒ¢ãƒ‡ãƒ«ã«ä¾å­˜ã—ãªã„ã‚‚ã®ã¨ãªã£ã¦ã„ã‚‹ã®ã§ä»Šå¾Œã®AI Agentã¸ã®å¤–éƒ¨ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹çµ„ã¿è¾¼ã¿ã®ã‚¹ã‚¿ãƒ³ãƒ€ãƒ¼ãƒ‰ã«ãªã£ã¦ã„ãã®ã§ã¯ï¼Ÿã¨æ³¨ç›®ã—ã¦ã„ã¾ã™ã€‚

æœ¬è¨˜äº‹ã§ã¯node.jsã‚’ç”¨ã„ã¦ç°¡æ˜“çš„ãªMCP Clientã¨MCP Serverã‚’ä½œæˆæ–¹æ³•ã‚’ç´¹ä»‹ã—ã¾ã™ã€‚

å®Ÿè£…ã—ãŸã‚‚ã®
githubä¸Šã®ã‚ã‚‹ãƒªãƒã‚¸ãƒˆãƒªã®ç›´è¿‘ã®ãƒãƒ¼ã‚¸ã•ã‚ŒãŸPRã®æƒ…å ±ã‚’å–å¾—ã™ã‚‹ãƒ„ãƒ¼ãƒ«ã‚’è¦ã™ã‚‹MCPã‚µãƒ¼ãƒãƒ¼
ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’å—ã‘å–ã‚Šã€å¿…è¦ã«å¿œã˜ã¦ä¸Šè¨˜ MCPã‚µãƒ¼ãƒãƒ¼ãŒæä¾›ã™ã‚‹ãƒ„ãƒ¼ãƒ«ã‚’åˆ©ç”¨ã—ãªãŒã‚‰å›ç­”ã™ã‚‹AI
AIã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã«ã¯groq-sdkã€ãƒ¢ãƒ‡ãƒ«ã¯llama-3.3-70b-versatileã§åˆ©ç”¨
MCPã‚µãƒ¼ãƒãƒ¼
mcp-server.ts

import { Server } from '@modelcontextprotocol/sdk/server/index.js';
import { StdioServerTransport } from '@modelcontextprotocol/sdk/server/stdio.js';

import { GithubClient } from 'libs/github-clinet';
import { setupPromptHandlers } from './prompts';
import { setupToolHandlers } from './tools';

const mcpServer = new Server(
  {
    name: 'my-mcp-server',
    version: '1.0.0',
  },
  {
    capabilities: {
      prompts: {},
      tools: {},
    },
  },
);
const githubClinet = new GithubClient();

console.error('my MCP Server starting...');

setupToolHandlers(mcpServer, githubClinet);

console.error('my MCP Server started');

async function runServer() {
  const transport = new StdioServerTransport();
  await mcpServer.connect(transport);
  console.error('my MCP Server running on stdio');
}
runServer().catch((error) => {
  console.error('Fatal error in main():', error);
  process.exit(1);
});
tools.ts

import type { Server } from '@modelcontextprotocol/sdk/server/index.js';
import {
  CallToolRequestSchema,
  ListToolsRequestSchema,
  type Tool,
} from '@modelcontextprotocol/sdk/types.js';
import type { GithubClient } from 'libs/github-clinet';

// Toolsã®å®šç¾©
const TOOLS: Record<string, Tool> = {
  'github-repo-merged-PRs-last-week': {
    name: 'github-repo-merged-PRs-last-week',
    description:
      'Retrieves detailed information about pull requests that were merged within the last week in the specified GitHub repository (owner/name). This method uses GitHub API v4 (GraphQL) to fetch data, including PR title, author, merge date, number of changed files, additions, deletions, and review status.',
    inputSchema: {
      type: 'object',
      properties: {
        owner: {
          type: 'string',
        },
        name: {
          type: 'string',
        },
      },
      required: ['owner', 'name'],
    },
  },
};

export const setupToolHandlers = (mcpServer: Server, githubClient: GithubClient) => {
  mcpServer.setRequestHandler(ListToolsRequestSchema, async () => ({
    tools: Object.values(TOOLS),
  }));

  mcpServer.setRequestHandler(CallToolRequestSchema, async (request) => {
    const tool = TOOLS[request.params.name];
    if (!tool) {
      throw new Error(`Tool not found: ${request.params.name}`);
    }
    // TOOLSã«ã¦å®šç¾©ã—ãŸtoolã”ã¨ã«å…·ä½“çš„ãªå‡¦ç†ã‚’å®Ÿè£…ã™ã‚‹
    if (request.params.name === 'github-repo-merged-PRs-last-week') {
      const owner = request.params.arguments?.owner as string;
      const name = request.params.arguments?.name as string;
      console.log('owner:', owner);
      console.log('name:', name);
      const repositoryPullRequestsResult = await githubClient.getMergedPRsLastWeek(owner, name, 3);
      return {
        content: [
          {
            type: 'text',
            text: JSON.stringify(repositoryPullRequestsResult),
          },
        ],
      };
    }

    throw new Error('Tool implementation not found');
  });
};
AIã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ(MCPã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ)
messagesé…åˆ—ã®ä¸­ã«ã€MCPã‚µãƒ¼ãƒãƒ¼ã‚’å‘¼ã³å‡ºã™ãŸã‚ã®role:assistantãªãƒ¡ãƒƒã‚»ãƒ¼ã‚¸, MCPã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰ã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’è¿½åŠ ã—ã¦æ–‡è„ˆã‚’å¢—ã‚„ã—ãªãŒã‚‰æœ€çµ‚çš„ãªå›ç­”ã‚’ç”Ÿæˆã™ã‚‹ã¨ã„ã†æµã‚Œã§å®Ÿè£…ã—ã¦ã„ã¾ã™ã€‚

mcp-client.ts

import path from 'node:path';
import { Client as MCPClient } from '@modelcontextprotocol/sdk/client/index.js';
import { StdioClientTransport } from '@modelcontextprotocol/sdk/client/stdio.js';
import dotenv from 'dotenv';
import Groq from 'groq-sdk';
import type {
  ChatCompletionMessageParam as GroqChatCompletionMessageParam,
  ChatCompletionTool as GroqChatCompletionTool,
} from 'groq-sdk/resources/chat/completions';
import OpenAI from 'openai';
import type { ChatCompletionMessageParam, ChatCompletionTool } from 'openai/resources';
import { z } from 'zod';

dotenv.config();

const myMCPServerScriptPath = path.join(process.cwd(), 'src', 'libs', 'mcp-server', 'index.ts');

const MODEL_NAME = 'llama-3.3-70b-versatile';
const MAX_TOKENS = 1000;

export class MyMCPClient {
  private mcpClient: MCPClient;
  private openaiClient: OpenAI;
  private groqClient: Groq;
  private transport: StdioClientTransport;
  private availableTools: Awaited<ReturnType<MCPClient['listTools']>>['tools'] = [];

  constructor() {
    this.mcpClient = new MCPClient({
      name: 'my-mcp-client',
      version: '1.0.0',
    });
    this.openaiClient = new OpenAI({
      apiKey: process.env.GROQ_API_KEY,
      baseURL: 'https://api.groq.com/openai/v1',
    });
    this.groqClient = new Groq({
      apiKey: process.env.GROQ_API_KEY,
    });

    const githubPersonalAccessToken = process.env.GITHUB_PERSONAL_ACCESS_TOKEN;
    if (!githubPersonalAccessToken) throw new Error('GITHUB_PERSONAL_ACCESS_TOKEN is not set');

    this.transport = new StdioClientTransport({
      command: 'tsx',
      args: [myMCPServerScriptPath],
      env: {
        GITHUB_PERSONAL_ACCESS_TOKEN: githubPersonalAccessToken,
        ...(process.env as Record<string, string>),
      },
    });
  }

  async connectToServer(): Promise<void> {
    await this.mcpClient.connect(this.transport);
    console.log('Connected to MCP server');
    const listToolsResponse = await this.mcpClient.listTools();
    this.availableTools = listToolsResponse.tools;
  }

  async processQuery(query: string): Promise<string | null | undefined> {
    const messages: Array<GroqChatCompletionMessageParam & { name?: string }> = [
      { role: 'user', content: query },
    ];
    const availableTools: Array<GroqChatCompletionTool> = this.availableTools.map((tool) => ({
      type: 'function',
      function: {
        name: tool.name,
        description: tool.description,
        parameters: tool.inputSchema,
      },
    }));

    const response = await this.groqClient.chat.completions.create({
      model: MODEL_NAME,
      messages: messages,
      tools: availableTools,
      tool_choice: 'required',
      max_completion_tokens: 4096,
    });

    const responseMessage = response.choices[0].message;
    const toolCalls = responseMessage.tool_calls;
    if (toolCalls) {
      messages.push(responseMessage);
      for (const toolCall of toolCalls.slice(0, 1)) {
        const toolName = toolCall.function.name;
        const toolArgs = JSON.parse(toolCall.function.arguments);
        const toolResult = await this.mcpClient.request(
          {
            method: 'tools/call',
            params: {
              name: toolName,
              arguments: toolArgs,
            },
          },
          z.any(),
        );

        // FOR DEBUG
        console.log('Tool call result:', toolResult);
        const toolResultContents = JSON.stringify(
          // biome-ignore lint/suspicious/noExplicitAny: <explanation>
          toolResult.content.map((content: any) => {
            if (content.type === 'text') return content.text;
            throw Error(`content type not supported: ${content.type}, ${content}`);
          }),
        );
        messages.push({
          tool_call_id: toolCall.id,
          role: 'tool',
          name: toolName,
          content: toolResultContents,
        });
      }
      const secondResponse = await this.groqClient.chat.completions.create({
        model: MODEL_NAME,
        messages: messages,
      });
      return secondResponse.choices[0].message.content;
    }
    return responseMessage.content;
  }

  async close(): Promise<void> {
    await this.mcpClient.close();
  }
}
å‹•ä½œç¢ºèª
'facebook/react ãƒªãƒã‚¸ãƒˆãƒªã®ç›´è¿‘ä¸€é€±é–“ã«ãƒãƒ¼ã‚¸ã•ã‚ŒPRã®å†…å®¹ã«ã¤ã„ã¦markdownå½¢å¼ã§è¦ç´„ã—ã¦ã€‚ã©ã®ã‚ˆã†ãªè­°è«–ãŒã‚ã£ãŸã‹ã‚‚è¦ç´„ã—ã¦ã€‚PRã®ãƒªãƒ³ã‚¯ã‚‚å‚ç…§ã§ãã‚‹ã‚ˆã†ã«ã—ã¦ã€‚'ã¨AIã«è³ªå•ã—ãŸå ´åˆã®çµæœã«ã§ã™ã€‚

### facebook/react ãƒªãƒã‚¸ãƒˆãƒªã®ç›´è¿‘ä¸€é€±é–“ã«ãƒãƒ¼ã‚¸ã•ã‚ŒãŸPRã®å†…å®¹ã«ã¤ã„ã¦

ä»¥ä¸‹ã®PRã¯ã€ç›´è¿‘ä¸€é€±é–“ã«ãƒãƒ¼ã‚¸ã•ã‚ŒãŸPRã§ã™ã€‚

*   **PR \#32621: Partially revert #32588**
    *   ã“ã®PRã¯ã€ãƒ†ã‚¹ãƒˆãŒé©åˆ‡ã«å®Ÿè¡Œã•ã‚Œãªã„å•é¡Œã‚’ä¿®æ­£ã™ã‚‹ãŸã‚ã«ã€å‰ã®PR \#32588ã§è¡Œã‚ã‚ŒãŸä¸€éƒ¨ã®å¤‰æ›´ã‚’å–ã‚Šæ¶ˆã—ã¦ã„ã¾ã™ã€‚
    *   [PR \#32621](https://github.com/facebook/react/pull/32621)
*   **PR \#32617: Remove Mutation Check Around commit/measureUpdateViewTransition**
    *   ã“ã®PRã¯ã€`commit/measureUpdateViewTransition`ã«ã‚ã–ã‚ã–å¤‰æ›´ã‚’ãƒã‚§ãƒƒã‚¯ã™ã‚‹å¿…è¦ãŒãªã„ã“ã¨ã‚’èªè­˜ã—ã€ä¸è¦ãªãƒã‚§ãƒƒã‚¯ã‚’å‰Šé™¤ã—ã¦ã„ã¾ã™ã€‚
    *   [PR \#32617](https://github.com/facebook/react/pull/32617)
*   **PR \#32613: Move traverseFragmentInstanceChildren to internal ReactFiberTreeReflection**
    *   ã“ã®PRã¯ã€`traverseFragmentInstanceChildren`ã¨ã„ã†é–¢æ•°ã‚’ã€å†…éƒ¨ã®`ReactFiberTreeReflection`ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã«ç§»å‹•ã™ã‚‹ã“ã¨ã§ã€ConfigãŒFiberã®å†…éƒ¨ã‚’çŸ¥ã‚‰ãªãã¦ã‚‚æ¸ˆã‚€ã‚ˆã†ã«ã—ã¦ã„ã¾ã™ã€‚
    *   [PR \#32613](https://github.com/facebook/react/pull/32613)
*   **PR \#32612: Measure and apply names for the "new" phase**
    *   ã“ã®PRã¯ã€"new"ãƒ•ã‚§ãƒ¼ã‚ºã® Animatedã¨Swipeã§ Namesã®ç¢ºèªã¨é©ç”¨ã‚’å®Ÿè£…ã—ã¦ã„ã¾ã™ã€‚
    *   [PR \#32612](https://github.com/facebook/react/pull/32612)
*   **PR \#32599: Find Pairs and Apply View Transition Names to the Clones in the "old" Phase**
    *   ã“ã®PRã¯ã€"old"ãƒ•ã‚§ãƒ¼ã‚ºã§ã€Animatedã¨Swipeã«å¯¾ã—ã¦ã€ViewTransition Boundariesã¨åå‰ã®ä¸€è‡´ã‚’ç¢ºèªã—ã¦ã„ã¾ã™ã€‚
    *   [PR \#32599](https://github.com/facebook/react/pull/32599)

### PRã®è­°è«–ã«ã¤ã„ã¦

ã“ã‚Œã‚‰ã®PRã«ã¤ã„ã¦ã¯ã€å¤šãã®è­°è«–ã‚„ç¢ºèªãŒè¡Œã‚ã‚Œã¦ã„ã¾ã™ã€‚é–‹ç™ºè€…åŒå£«ã§_CODE_ã‚„ãƒ­ã‚¸ãƒƒã‚¯ã«ã¤ã„ã¦æ„è¦‹ã‚’å‡ºã—åˆã„ã€å„è‡ªãŒè¡Œã£ãŸå¤‰æ›´ç‚¹ã«ã¤ã„ã¦èª¬æ˜ã—ã¦ã„ã¾ã™ã€‚ ä¸€éƒ¨ã®PRã§ã¯ã€ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆã‚’é€šã˜ã¦å•é¡Œç‚¹ã®å¯è¦–åŒ–ãŒè¡Œã‚ã‚Œã€ç†è§£ã‚’ä¿ƒé€²ã—ã¦ã„ã¾ã™ã€‚ é€†ã«ã€ä»–ã®PRã§ã¯ã€é–‹ç™ºè€…é–“ã§ã®ç¢ºèªã‚„æ‰¿èªãŒã€ãƒ†ã‚­ã‚¹ãƒˆãƒ™ãƒ¼ã‚¹ã§ã®ã¿è¡Œã‚ã‚Œã¦ã„ã‚‹æ§˜å­ãŒã‚ã‚Šã¾ã™ã€‚ ã“ã®ã‚ˆã†ã«ã€facebook/reactã®é–‹ç™ºã§ã¯ã€é–‹ç™ºè€…ã®ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒæ´»ç™ºã«è¡Œã‚ã‚Œã¦ã„ã‚‹ã“ã¨ãŒæ„Ÿã˜ã‚‰ã‚Œã¾ã™ã€‚
ä»¥ä¸‹ã¯messageã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ä¸­èº«ã§ã™ã€‚

[
  {
    role: 'user',
    content: 'facebook/react ãƒªãƒã‚¸ãƒˆãƒªã®ç›´è¿‘ä¸€é€±é–“ã«ãƒãƒ¼ã‚¸ã•ã‚ŒPRã®å†…å®¹ã«ã¤ã„ã¦markdownå½¢å¼ã§è¦ç´„ã—ã¦ã€‚ã©ã®ã‚ˆã†ãªè­°è«–ãŒã‚ã£ãŸã‹ã‚‚è¦ç´„ã—ã¦ã€‚PRã®ãƒªãƒ³ã‚¯ã‚‚å‚ç…§ã§ãã‚‹ã‚ˆã†ã«ã—ã¦ã€‚'
  },
  {
    role: 'assistant',
    tool_calls: [
      {
        id: 'call_akw3',
        type: 'function',
        function: {
          name: 'github-repo-merged-PRs-last-week',
          arguments: '{"owner": "facebook", "name": "react"}'
        }
      }
    ]
  },
  {
    tool_call_id: 'call_akw3',
    role: 'tool',
    name: 'github-repo-merged-PRs-last-week',
    content: '[toolã‹ã‚‰ã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹]' 
  }
]
æœ€å¾Œã«
AI Agenetçš„ã«LLMã‚’åˆ©ç”¨ã™ã‚‹ã¨ã©ã†ã—ã¦ã‚‚åˆ©ç”¨ãƒˆãƒ¼ã‚¯ãƒ³ãŒçˆ†å¢—ã—ã¾ã†ã®ã§ã€ç¾çŠ¶å€‹äººã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«çµ„ã¿è¾¼ã‚€ã«ã¯ã‚³ã‚¹ãƒˆãŒã™ã”ã„ã“ã¨ã«ãªã‚Šãã†ãªæ°—ãŒã—ã¾ã—ãŸğŸ¥²

groqã®ç„¡æ–™æ ã®ç¯„å›²å†…ã§åŠ¹ç‡çš„ãªæƒ…å ±åé›†ã‚„å®šæœŸå®Ÿè¡Œç­‰ã§åˆ©ç”¨ã§ãã‚Œã°ã‚ˆã„ãªãƒ¼ã¨æ€ã£ãŸã‚Šã—ã¦ã„ã¾ã™ã€‚